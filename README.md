# Relay4-board
Board with 4 relays to control generator ventilation

Detailed description here:
https://vad-7.blogspot.com/2024/04/relayboard4.html

<img src="https://raw.githubusercontent.com/vad7/Relay4-board/master/3D.png">

Алгоритм работы простой - при появлении питания на входе 5V_GEN выполняется  записанная в EEPROM-е последовательность переключения реле, которая включает вентилятор, вместе с воздушным клапаном. При этом наличие напряжения на входе 5V_LINE уже не имеет значения.

После выключении генератора выполняется последовательность переключения реле на вход 5V_LINE, если там конечно, есть напряжение. Через заданное в настройках время будет запущена еще одна последовательность для выключения вентиляции.

Кнопка (переключатель) SW1 может работать в двух режимах:

Кратковременное нажатие - запуск последовательности включения, последовательность выключения запускается после задержки (EEPROM - 0x02).

Переключатель - после переключения во Вкл - последовательность выключения, после Выкл - последовательность выключения.

Кнопкой можно заново настроить задержку выключения - для этого нужно кратковременно нажать на нее (быстро переключить, если это переключатель) 5 раз подряд. Зеленый светодиод мигнет 5 раз, далее каждое нажатие на кнопку увеличивает задержку на 1 минуту, начиная с 0. Через 20 секунд светодиодом промигнется установленное значение в шестнадцатеричном виде в минутах и запишется в EEPROM.

Настройки EEPROM:

0x01 - Минимальная пауза между последовательностями, 0..255 секунд.

0x02 - Задержка выключения после пропадания 5V_LINE, 2 байта, 0..65535 секунд.

0x04 - Команда задержки на время переключения реле, десятые секунд.

0x10 - Последовательности по входу LINE: сначала команды для включения до cmd_End, далее команды для выключения до cmd_End.

0x70 - Последовательности по входу GEN, аналогично как для LINE.

Команды:

cmd_Relay1_On    -  0

cmd_Relay1_Off    - 1

cmd_Relay2_On    - 2

cmd_Relay2_Off    - 3

cmd_Relay3_On    - 4

cmd_Relay3_Off    - 5

cmd_Relay4_On    - 6

cmd_Relay4_Off    - 7

cmd_RelayDelay    - 8 (EEPROM 0x04)

cmd_Delay             - 9 (следующие 2 байта за командой время 1..65535 сек)

cmd_End                - 0xFF

Фьюзы: BODLEVEL[2:0] = 101, RSTDISBL=0
